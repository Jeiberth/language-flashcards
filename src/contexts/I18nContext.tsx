
import React, { createContext, useContext, useEffect, useState } from 'react';

export type Language = 'en' | 'es' | 'fr';

interface I18nContextType {
  language: Language;
  setLanguage: (lang: Language) => void;
  t: (key: string) => string;
}

const I18nContext = createContext<I18nContextType | undefined>(undefined);

export const useI18n = () => {
  const context = useContext(I18nContext);
  if (!context) {
    throw new Error('useI18n must be used within I18nProvider');
  }
  return context;
};

// Translation keys and values
const translations = {
  en: {
    // Navigation
    'nav.home': 'Home',
    'nav.dashboard': 'Dashboard',
    'nav.review': 'Review',
    'nav.manage': 'Manage',
    'nav.settings': 'Settings',
    
    // Home page
    'home.title': 'Language Flashcards',
    'home.subtitle': 'Master vocabulary with smart spaced repetition, offline storage, and pronunciation practice',
    'home.continue.learning': 'Continue Learning',
    'home.view.progress': 'View Progress',
    'home.create.first': 'Create Your First Card',
    'home.import.existing': 'Import Existing Cards',
    'home.stats.total': 'Total Cards',
    'home.stats.due': 'Due Today',
    'home.stats.reviewed': 'Reviewed Today',
    'home.stats.mastery': 'Mastery',
    'home.features.spaced.title': 'Spaced Repetition',
    'home.features.spaced.desc': 'Smart algorithm that shows cards when you need to review them most.',
    'home.features.tts.title': 'Text-to-Speech',
    'home.features.tts.desc': 'Hear correct pronunciation for French words and phrases.',
    'home.features.offline.title': 'Offline-First',
    'home.features.offline.desc': 'All your data stays on your device. Works without internet.',
    'home.features.import.title': 'Import/Export',
    'home.features.import.desc': 'Sync your flashcards between devices with easy data transfer.',
    'home.how.title': 'How It Works',
    'home.how.step1': 'Create Cards',
    'home.how.step1.desc': 'Add French words with English translations',
    'home.how.step2': 'Review & Rate',
    'home.how.step2.desc': 'Practice cards and rate your confidence',
    'home.how.step3': 'Smart Scheduling',
    'home.how.step3.desc': 'Cards appear when you need to review them',

    // Dashboard page
    'dashboard.title': 'Learning Dashboard',
    'dashboard.motivation.caught_up': "Great job! You're all caught up with your reviews! ðŸŽ‰",
    'dashboard.motivation.few_cards': "You're almost there! Just a few more cards to review! ðŸ’ª",
    'dashboard.motivation.good_momentum': "Good momentum! Let's tackle those reviews! ðŸš€",
    'dashboard.motivation.dive_in': "Time to dive in! Breaking it into small sessions works best! ðŸŽ¯",
    'dashboard.stats.total': 'Total Cards',
    'dashboard.stats.total.desc': 'Cards in your collection',
    'dashboard.stats.due': 'Due Today',
    'dashboard.stats.due.desc': 'Cards ready for review',
    'dashboard.stats.reviewed': 'Reviewed Today',
    'dashboard.stats.reviewed.desc': 'Cards studied today',
    'dashboard.stats.streak': 'Current Streak',
    'dashboard.stats.streak.desc': 'Days studied in a row',
    'dashboard.stats.mastery': 'Mastery Level',
    'dashboard.stats.mastery.desc': 'Cards marked as easy',
    'dashboard.goal.title': "Today's Goal",
    'dashboard.goal.caught_up': 'All caught up!',
    'dashboard.goal.no_cards': 'No cards due for review today',
    'dashboard.goal.progress': 'Progress',
    'dashboard.goal.remaining': 'cards remaining to review',
    'dashboard.mastery.title': 'Mastery Progress',
    'dashboard.mastery.level': 'Mastery Level',
    'dashboard.mastery.of': 'of',
    'dashboard.mastery.mastered': 'cards mastered',
    'dashboard.actions.title': 'Quick Actions',
    'dashboard.actions.subtitle': 'Jump to your most common tasks',
    'dashboard.actions.review': 'Start Review',
    'dashboard.actions.add': 'Add Cards',
    'dashboard.actions.stats': 'View Stats',
    'dashboard.actions.settings': 'Settings',

    // Review page
    'review.title.due': 'Review Session',
    'review.title.all': 'Practice Session',
    'review.subtitle': 'Card',
    'review.subtitle.of': 'of',
    'review.card.french': 'French Word',
    'review.card.translation': 'Translation',
    'review.listen': 'Listen',
    'review.show.answer': 'Show Answer',
    'review.how.well': 'How well did you know this word?',
    'review.answer.again': 'Again',
    'review.answer.hard': 'Hard',
    'review.answer.good': 'Good',
    'review.answer.easy': 'Easy',
    'review.all.done': 'All Done!',
    'review.no.cards': 'No Cards Available!',
    'review.no.due': 'No cards are due for review right now.',
    'review.no.collection': 'No flashcards found in your collection.',
    'review.check.again': 'Check Again',
    'review.all.cards': 'Review All Cards',
    'review.loading': 'Loading cards...',

    // Manage page  
    'manage.title': 'Manage Cards',
    'manage.subtitle': 'Add, edit, or delete your flashcards',
    'manage.add.title': 'Add New Card',
    'manage.french.label': 'French Word/Phrase',
    'manage.french.placeholder': 'Enter French word...',
    'manage.english.label': 'English Translation',
    'manage.english.placeholder': 'Enter English translation...',
    'manage.add.button': 'Add Card',
    'manage.search.placeholder': 'Search cards...',
    'manage.loading': 'Loading cards...',
    'manage.no.match': 'No cards match your search.',
    'manage.no.cards': 'No cards yet. Add your first card above!',
    'manage.save': 'Save',
    'manage.cancel': 'Cancel',
    
    // Settings page
    'settings.title': 'Settings',
    'settings.subtitle': 'Manage your app preferences and data',
    'settings.voice.title': 'Voice & Pronunciation',
    'settings.voice.subtitle': 'Customize text-to-speech settings',
    'settings.voice.loading': 'Loading voices...',
    'settings.voice.description': 'Choose the language you want to practice and then select a specific voice that sounds most natural to you.',
    'settings.language.title': 'Language & Appearance',
    'settings.language.subtitle': 'Choose your preferred language and theme',
    'settings.practice.language': 'Practice Language',
    'settings.voice.selection': 'Voice Selection',
    'settings.theme': 'Theme',
    'settings.theme.light': 'Light',
    'settings.theme.dark': 'Dark',
    'settings.theme.system': 'System',
    'settings.test.voice': 'Test Voice',
    'settings.data.title': 'Data Management',
    'settings.data.subtitle': 'Export, import, or manage your flashcard data',
    'settings.bulk.import': 'Bulk Import',
    'settings.bulk.subtitle': 'Add multiple flashcards at once from text',
    'settings.export.title': 'Export Data',
    'settings.export.description': 'Download all your flashcards as a JSON file for backup or transfer',
    'settings.export.loading': 'Exporting...',
    'settings.export': 'Export All Cards',
    'settings.import': 'Import Data',
    'settings.import.description': 'Upload a JSON file to import flashcards (will merge with existing cards)',
    'settings.import.loading': 'Importing...',
    'settings.about': 'About',
    'settings.about.description': 'A progressive web app for language learning with spaced repetition, offline storage, enhanced text-to-speech capabilities, dark mode, and multi-language support.',
    'settings.about.features': 'Features',
    'settings.about.feature.spaced': 'Spaced repetition algorithm for optimal learning',
    'settings.about.feature.offline': 'Offline-first with IndexedDB storage',
    'settings.about.feature.voice': 'Multi-language voice selection with auto-detection',
    'settings.about.feature.dark': 'Dark mode and system theme support',
    'settings.about.feature.i18n': 'Internationalization (English, Spanish, French)',
    'settings.about.feature.progress': 'Progress tracking and statistics',
    'settings.about.feature.bulk': 'Bulk import for multiple cards',
    'settings.about.feature.import': 'Import/export functionality',
    'settings.danger': 'Danger Zone',
    'settings.danger.subtitle': 'Irreversible actions that will permanently delete your data',
    'settings.danger.warning': 'This action cannot be undone. Make sure to export your data first.',
    'settings.delete.all': 'Delete All Cards',
    
    // Test phrases
    'test.phrase.en': 'Hello! How are you? This is an English pronunciation test.',
    'test.phrase.es': 'Â¡Hola! Â¿CÃ³mo estÃ¡s? Esta es una prueba de pronunciaciÃ³n en espaÃ±ol.',
    'test.phrase.fr': 'Bonjour ! Comment allez-vous ? Ceci est un test de prononciation franÃ§aise.',

    // Confirmation dialogs
    'confirm.delete.all.title': 'Delete All Cards',
    'confirm.delete.all.description': 'Are you sure you want to delete all cards? This action cannot be undone.',
    'confirm.delete.all.confirm': 'Delete All',
    'confirm.delete.card.title': 'Delete Card',
    'confirm.delete.card.description': 'Are you sure you want to delete this card? This action cannot be undone.',
    'confirm.delete.card.confirm': 'Delete',
    'confirm.cancel': 'Cancel',
    'confirm.continue': 'Continue',
    
    // Success messages
    'success.import': 'Import successful!',
    'success.export': 'Export completed successfully!',
    'success.delete.all': 'All data has been cleared.',
    'success.card.added': 'Card added successfully!',
    'success.card.updated': 'Card updated successfully!',
    'success.card.deleted': 'Card deleted successfully!',
    
    // Error messages
    'error.import': 'Import failed. Please check the file format and try again.',
    'error.export': 'Export failed. Please try again.',
    'error.delete.all': 'Failed to clear data. Please try again.',
    'error.card.add': 'Failed to add card. Please try again.',
    'error.card.update': 'Failed to update card. Please try again.',
    'error.card.delete': 'Failed to delete card. Please try again.',
    'error.load.cards': 'Failed to load cards. Please try again.',
    'error.voice.change': 'Failed to change voice. Please try again.',
    'error.voice.test': 'Failed to test voice. Please try again.',
  },
  es: {
    // Navigation
    'nav.home': 'Inicio',
    'nav.dashboard': 'Panel',
    'nav.review': 'Repasar',
    'nav.manage': 'Gestionar',
    'nav.settings': 'ConfiguraciÃ³n',
    
    // Home page
    'home.title': 'Tarjetas de Idioma',
    'home.subtitle': 'Domina el vocabulario con repeticiÃ³n espaciada inteligente, almacenamiento offline y prÃ¡ctica de pronunciaciÃ³n',
    'home.continue.learning': 'Continuar Aprendiendo',
    'home.view.progress': 'Ver Progreso',
    'home.create.first': 'Crear Tu Primera Tarjeta',
    'home.import.existing': 'Importar Tarjetas Existentes',
    'home.stats.total': 'Total de Tarjetas',
    'home.stats.due': 'Pendientes Hoy',
    'home.stats.reviewed': 'Repasadas Hoy',
    'home.stats.mastery': 'Dominio',
    'home.features.spaced.title': 'RepeticiÃ³n Espaciada',
    'home.features.spaced.desc': 'Algoritmo inteligente que muestra las tarjetas cuando mÃ¡s necesitas repasarlas.',
    'home.features.tts.title': 'Texto a Voz',
    'home.features.tts.desc': 'Escucha la pronunciaciÃ³n correcta de palabras y frases en francÃ©s.',
    'home.features.offline.title': 'Offline Primero',
    'home.features.offline.desc': 'Todos tus datos permanecen en tu dispositivo. Funciona sin internet.',
    'home.features.import.title': 'Importar/Exportar',
    'home.features.import.desc': 'Sincroniza tus tarjetas entre dispositivos con transferencia fÃ¡cil de datos.',
    'home.how.title': 'CÃ³mo Funciona',
    'home.how.step1': 'Crear Tarjetas',
    'home.how.step1.desc': 'AÃ±ade palabras en francÃ©s con traducciones al espaÃ±ol',
    'home.how.step2': 'Repasar y Calificar',
    'home.how.step2.desc': 'Practica tarjetas y califica tu confianza',
    'home.how.step3': 'ProgramaciÃ³n Inteligente',
    'home.how.step3.desc': 'Las tarjetas aparecen cuando necesitas repasarlas',

    // Dashboard page
    'dashboard.title': 'Panel de Aprendizaje',
    'dashboard.motivation.caught_up': "Â¡Excelente trabajo! Â¡EstÃ¡s al dÃ­a con tus repasos! ðŸŽ‰",
    'dashboard.motivation.few_cards': "Â¡Ya casi! Â¡Solo unas pocas tarjetas mÃ¡s para repasar! ðŸ’ª",
    'dashboard.motivation.good_momentum': "Â¡Buen ritmo! Â¡Vamos a abordar esos repasos! ðŸš€",
    'dashboard.motivation.dive_in': "Â¡Hora de sumergirse! Â¡Dividirlo en sesiones pequeÃ±as funciona mejor! ðŸŽ¯",
    'dashboard.stats.total': 'Total de Tarjetas',
    'dashboard.stats.total.desc': 'Tarjetas en tu colecciÃ³n',
    'dashboard.stats.due': 'Pendientes Hoy',
    'dashboard.stats.due.desc': 'Tarjetas listas para repasar',
    'dashboard.stats.reviewed': 'Repasadas Hoy',
    'dashboard.stats.reviewed.desc': 'Tarjetas estudiadas hoy',
    'dashboard.stats.streak': 'Racha Actual',
    'dashboard.stats.streak.desc': 'DÃ­as estudiados seguidos',
    'dashboard.stats.mastery': 'Nivel de Dominio',
    'dashboard.stats.mastery.desc': 'Tarjetas marcadas como fÃ¡ciles',
    'dashboard.goal.title': 'Meta de Hoy',
    'dashboard.goal.caught_up': 'Â¡Todo al dÃ­a!',
    'dashboard.goal.no_cards': 'No hay tarjetas pendientes para repasar hoy',
    'dashboard.goal.progress': 'Progreso',
    'dashboard.goal.remaining': 'tarjetas restantes para repasar',
    'dashboard.mastery.title': 'Progreso de Dominio',
    'dashboard.mastery.level': 'Nivel de Dominio',
    'dashboard.mastery.of': 'de',
    'dashboard.mastery.mastered': 'tarjetas dominadas',
    'dashboard.actions.title': 'Acciones RÃ¡pidas',
    'dashboard.actions.subtitle': 'Salta a tus tareas mÃ¡s comunes',
    'dashboard.actions.review': 'Comenzar Repaso',
    'dashboard.actions.add': 'AÃ±adir Tarjetas',
    'dashboard.actions.stats': 'Ver EstadÃ­sticas',
    'dashboard.actions.settings': 'ConfiguraciÃ³n',

    // Review page
    'review.title.due': 'SesiÃ³n de Repaso',
    'review.title.all': 'SesiÃ³n de PrÃ¡ctica',
    'review.subtitle': 'Tarjeta',
    'review.subtitle.of': 'de',
    'review.card.french': 'Palabra en FrancÃ©s',
    'review.card.translation': 'TraducciÃ³n',
    'review.listen': 'Escuchar',
    'review.show.answer': 'Mostrar Respuesta',
    'review.how.well': 'Â¿QuÃ© tan bien conocÃ­as esta palabra?',
    'review.answer.again': 'Otra Vez',
    'review.answer.hard': 'DifÃ­cil',
    'review.answer.good': 'Bien',
    'review.answer.easy': 'FÃ¡cil',
    'review.all.done': 'Â¡Todo Terminado!',
    'review.no.cards': 'Â¡No Hay Tarjetas Disponibles!',
    'review.no.due': 'No hay tarjetas pendientes para repasar ahora.',
    'review.no.collection': 'No se encontraron tarjetas en tu colecciÃ³n.',
    'review.check.again': 'Verificar Otra Vez',
    'review.all.cards': 'Repasar Todas las Tarjetas',
    'review.loading': 'Cargando tarjetas...',

    // Manage page  
    'manage.title': 'Gestionar Tarjetas',
    'manage.subtitle': 'AÃ±adir, editar o eliminar tus tarjetas',
    'manage.add.title': 'AÃ±adir Nueva Tarjeta',
    'manage.french.label': 'Palabra/Frase en FrancÃ©s',
    'manage.french.placeholder': 'Ingresa palabra en francÃ©s...',
    'manage.english.label': 'TraducciÃ³n al EspaÃ±ol',
    'manage.english.placeholder': 'Ingresa traducciÃ³n al espaÃ±ol...',
    'manage.add.button': 'AÃ±adir Tarjeta',
    'manage.search.placeholder': 'Buscar tarjetas...',
    'manage.loading': 'Cargando tarjetas...',
    'manage.no.match': 'Ninguna tarjeta coincide con tu bÃºsqueda.',
    'manage.no.cards': 'Â¡AÃºn no hay tarjetas. AÃ±ade tu primera tarjeta arriba!',
    'manage.save': 'Guardar',
    'manage.cancel': 'Cancelar',
    
    // Settings page
    'settings.title': 'ConfiguraciÃ³n',
    'settings.subtitle': 'Gestiona las preferencias de tu aplicaciÃ³n y datos',
    'settings.voice.title': 'Voz y PronunciaciÃ³n',
    'settings.voice.subtitle': 'Personaliza la configuraciÃ³n de texto a voz',
    'settings.voice.loading': 'Cargando voces...',
    'settings.voice.description': 'Elige el idioma que quieres practicar y luego selecciona una voz especÃ­fica que te suene mÃ¡s natural.',
    'settings.language.title': 'Idioma y Apariencia',
    'settings.language.subtitle': 'Elige tu idioma y tema preferidos',
    'settings.practice.language': 'Idioma de PrÃ¡ctica',
    'settings.voice.selection': 'SelecciÃ³n de Voz',
    'settings.theme': 'Tema',
    'settings.theme.light': 'Claro',
    'settings.theme.dark': 'Oscuro',
    'settings.theme.system': 'Sistema',
    'settings.test.voice': 'Probar Voz',
    'settings.data.title': 'GestiÃ³n de Datos',
    'settings.data.subtitle': 'Exporta, importa o gestiona tus datos de tarjetas',
    'settings.bulk.import': 'ImportaciÃ³n Masiva',
    'settings.bulk.subtitle': 'AÃ±ade mÃºltiples tarjetas desde texto',
    'settings.export.title': 'Exportar Datos',
    'settings.export.description': 'Descarga todas tus tarjetas como archivo JSON para respaldo o transferencia',
    'settings.export.loading': 'Exportando...',
    'settings.export': 'Exportar Todas las Tarjetas',
    'settings.import': 'Importar Datos',
    'settings.import.description': 'Sube un archivo JSON para importar tarjetas (se fusionarÃ¡ con las existentes)',
    'settings.import.loading': 'Importando...',
    'settings.about': 'Acerca de',
    'settings.about.description': 'Una aplicaciÃ³n web progresiva para aprender idiomas con repeticiÃ³n espaciada, almacenamiento offline, capacidades mejoradas de texto a voz, modo oscuro y soporte multiidioma.',
    'settings.about.features': 'CaracterÃ­sticas',
    'settings.about.feature.spaced': 'Algoritmo de repeticiÃ³n espaciada para aprendizaje Ã³ptimo',
    'settings.about.feature.offline': 'Offline primero con almacenamiento IndexedDB',
    'settings.about.feature.voice': 'SelecciÃ³n de voz multiidioma con detecciÃ³n automÃ¡tica',
    'settings.about.feature.dark': 'Soporte de modo oscuro y tema del sistema',
    'settings.about.feature.i18n': 'InternacionalizaciÃ³n (InglÃ©s, EspaÃ±ol, FrancÃ©s)',
    'settings.about.feature.progress': 'Seguimiento de progreso y estadÃ­sticas',
    'settings.about.feature.bulk': 'ImportaciÃ³n masiva para mÃºltiples tarjetas',
    'settings.about.feature.import': 'Funcionalidad de importar/exportar',
    'settings.danger': 'Zona de Peligro',
    'settings.danger.subtitle': 'Acciones irreversibles que eliminarÃ¡n permanentemente tus datos',
    'settings.danger.warning': 'Esta acciÃ³n no se puede deshacer. AsegÃºrate de exportar tus datos primero.',
    'settings.delete.all': 'Eliminar Todas las Tarjetas',
    
    // Test phrases
    'test.phrase.en': 'Hello! How are you? This is an English pronunciation test.',
    'test.phrase.es': 'Â¡Hola! Â¿CÃ³mo estÃ¡s? Esta es una prueba de pronunciaciÃ³n en espaÃ±ol.',
    'test.phrase.fr': 'Bonjour ! Comment allez-vous ? Ceci est un test de prononciation franÃ§aise.',

    // Confirmation dialogs
    'confirm.delete.all.title': 'Eliminar Todas las Tarjetas',
    'confirm.delete.all.description': 'Â¿EstÃ¡s seguro de que quieres eliminar todas las tarjetas? Esta acciÃ³n no se puede deshacer.',
    'confirm.delete.all.confirm': 'Eliminar Todo',
    'confirm.delete.card.title': 'Eliminar Tarjeta',
    'confirm.delete.card.description': 'Â¿EstÃ¡s seguro de que quieres eliminar esta tarjeta? Esta acciÃ³n no se puede deshacer.',
    'confirm.delete.card.confirm': 'Eliminar',
    'confirm.cancel': 'Cancelar',
    'confirm.continue': 'Continuar',
    
    // Success messages
    'success.import': 'Â¡ImportaciÃ³n exitosa!',
    'success.export': 'Â¡ExportaciÃ³n completada con Ã©xito!',
    'success.delete.all': 'Todos los datos han sido eliminados.',
    'success.card.added': 'Â¡Tarjeta aÃ±adida con Ã©xito!',
    'success.card.updated': 'Â¡Tarjeta actualizada con Ã©xito!',
    'success.card.deleted': 'Â¡Tarjeta eliminada con Ã©xito!',
    
    // Error messages
    'error.import': 'Error en la importaciÃ³n. Por favor verifica el formato del archivo e intÃ©ntalo de nuevo.',
    'error.export': 'Error en la exportaciÃ³n. Por favor intÃ©ntalo de nuevo.',
    'error.delete.all': 'Error al eliminar los datos. Por favor intÃ©ntalo de nuevo.',
    'error.card.add': 'Error al aÃ±adir la tarjeta. Por favor intÃ©ntalo de nuevo.',
    'error.card.update': 'Error al actualizar la tarjeta. Por favor intÃ©ntalo de nuevo.',
    'error.card.delete': 'Error al eliminar la tarjeta. Por favor intÃ©ntalo de nuevo.',
    'error.load.cards': 'Error al cargar las tarjetas. Por favor intÃ©ntalo de nuevo.',
    'error.voice.change': 'Error al cambiar la voz. Por favor intÃ©ntalo de nuevo.',
    'error.voice.test': 'Error al probar la voz. Por favor intÃ©ntalo de nuevo.',
  },
  fr: {
    // Navigation
    'nav.home': 'Accueil',
    'nav.dashboard': 'Tableau de bord',
    'nav.review': 'RÃ©viser',
    'nav.manage': 'GÃ©rer',
    'nav.settings': 'ParamÃ¨tres',
    
    // Home page
    'home.title': 'Cartes de Langue',
    'home.subtitle': 'MaÃ®trisez le vocabulaire avec la rÃ©pÃ©tition espacÃ©e intelligente, le stockage hors ligne et la pratique de la prononciation',
    'home.continue.learning': 'Continuer l\'Apprentissage',
    'home.view.progress': 'Voir le ProgrÃ¨s',
    'home.create.first': 'CrÃ©er Votre PremiÃ¨re Carte',
    'home.import.existing': 'Importer des Cartes Existantes',
    'home.stats.total': 'Total des Cartes',
    'home.stats.due': 'Ã€ Faire Aujourd\'hui',
    'home.stats.reviewed': 'RÃ©visÃ©es Aujourd\'hui',
    'home.stats.mastery': 'MaÃ®trise',
    'home.features.spaced.title': 'RÃ©pÃ©tition EspacÃ©e',
    'home.features.spaced.desc': 'Algorithme intelligent qui montre les cartes quand vous devez les rÃ©viser le plus.',
    'home.features.tts.title': 'Texte vers Parole',
    'home.features.tts.desc': 'Entendez la prononciation correcte des mots et phrases franÃ§ais.',
    'home.features.offline.title': 'Hors Ligne d\'Abord',
    'home.features.offline.desc': 'Toutes vos donnÃ©es restent sur votre appareil. Fonctionne sans internet.',
    'home.features.import.title': 'Importer/Exporter',
    'home.features.import.desc': 'Synchronisez vos cartes entre appareils avec un transfert de donnÃ©es facile.',
    'home.how.title': 'Comment Ã‡a Marche',
    'home.how.step1': 'CrÃ©er des Cartes',
    'home.how.step1.desc': 'Ajoutez des mots franÃ§ais avec des traductions franÃ§aises',
    'home.how.step2': 'RÃ©viser et Ã‰valuer',
    'home.how.step2.desc': 'Pratiquez les cartes et Ã©valuez votre confiance',
    'home.how.step3': 'Planification Intelligente',
    'home.how.step3.desc': 'Les cartes apparaissent quand vous devez les rÃ©viser',

    // Dashboard page
    'dashboard.title': 'Tableau de Bord d\'Apprentissage',
    'dashboard.motivation.caught_up': "Excellent travail ! Vous Ãªtes Ã  jour avec vos rÃ©visions ! ðŸŽ‰",
    'dashboard.motivation.few_cards': "Vous y Ãªtes presque ! Juste quelques cartes de plus Ã  rÃ©viser ! ðŸ’ª",
    'dashboard.motivation.good_momentum': "Bon Ã©lan ! Attaquons ces rÃ©visions ! ðŸš€",
    'dashboard.motivation.dive_in': "Il est temps de s'y mettre ! Diviser en petites sessions fonctionne mieux ! ðŸŽ¯",
    'dashboard.stats.total': 'Total des Cartes',
    'dashboard.stats.total.desc': 'Cartes dans votre collection',
    'dashboard.stats.due': 'Ã€ Faire Aujourd\'hui',
    'dashboard.stats.due.desc': 'Cartes prÃªtes Ã  rÃ©viser',
    'dashboard.stats.reviewed': 'RÃ©visÃ©es Aujourd\'hui',
    'dashboard.stats.reviewed.desc': 'Cartes Ã©tudiÃ©es aujourd\'hui',
    'dashboard.stats.streak': 'SÃ©rie Actuelle',
    'dashboard.stats.streak.desc': 'Jours Ã©tudiÃ©s d\'affilÃ©e',
    'dashboard.stats.mastery': 'Niveau de MaÃ®trise',
    'dashboard.stats.mastery.desc': 'Cartes marquÃ©es comme faciles',
    'dashboard.goal.title': 'Objectif d\'Aujourd\'hui',
    'dashboard.goal.caught_up': 'Tout Ã  jour !',
    'dashboard.goal.no_cards': 'Aucune carte Ã  rÃ©viser aujourd\'hui',
    'dashboard.goal.progress': 'ProgrÃ¨s',
    'dashboard.goal.remaining': 'cartes restantes Ã  rÃ©viser',
    'dashboard.mastery.title': 'ProgrÃ¨s de MaÃ®trise',
    'dashboard.mastery.level': 'Niveau de MaÃ®trise',
    'dashboard.mastery.of': 'sur',
    'dashboard.mastery.mastered': 'cartes maÃ®trisÃ©es',
    'dashboard.actions.title': 'Actions Rapides',
    'dashboard.actions.subtitle': 'Passez Ã  vos tÃ¢ches les plus courantes',
    'dashboard.actions.review': 'Commencer la RÃ©vision',
    'dashboard.actions.add': 'Ajouter des Cartes',
    'dashboard.actions.stats': 'Voir les Statistiques',
    'dashboard.actions.settings': 'ParamÃ¨tres',

    // Review page
    'review.title.due': 'Session de RÃ©vision',
    'review.title.all': 'Session de Pratique',
    'review.subtitle': 'Carte',
    'review.subtitle.of': 'sur',
    'review.card.french': 'Mot FranÃ§ais',
    'review.card.translation': 'Traduction',
    'review.listen': 'Ã‰couter',
    'review.show.answer': 'Montrer la RÃ©ponse',
    'review.how.well': 'Ã€ quel point connaissiez-vous ce mot ?',
    'review.answer.again': 'Encore',
    'review.answer.hard': 'Difficile',
    'review.answer.good': 'Bien',
    'review.answer.easy': 'Facile',
    'review.all.done': 'Tout TerminÃ© !',
    'review.no.cards': 'Aucune Carte Disponible !',
    'review.no.due': 'Aucune carte Ã  rÃ©viser maintenant.',
    'review.no.collection': 'Aucune carte trouvÃ©e dans votre collection.',
    'review.check.again': 'VÃ©rifier Encore',
    'review.all.cards': 'RÃ©viser Toutes les Cartes',
    'review.loading': 'Chargement des cartes...',

    // Manage page  
    'manage.title': 'GÃ©rer les Cartes',
    'manage.subtitle': 'Ajouter, modifier ou supprimer vos cartes',
    'manage.add.title': 'Ajouter une Nouvelle Carte',
    'manage.french.label': 'Mot/Phrase FranÃ§ais',
    'manage.french.placeholder': 'Entrez un mot franÃ§ais...',
    'manage.english.label': 'Traduction FranÃ§aise',
    'manage.english.placeholder': 'Entrez la traduction franÃ§aise...',
    'manage.add.button': 'Ajouter une Carte',
    'manage.search.placeholder': 'Rechercher des cartes...',
    'manage.loading': 'Chargement des cartes...',
    'manage.no.match': 'Aucune carte ne correspond Ã  votre recherche.',
    'manage.no.cards': 'Pas encore de cartes. Ajoutez votre premiÃ¨re carte ci-dessus !',
    'manage.save': 'Enregistrer',
    'manage.cancel': 'Annuler',
    
    // Settings page
    'settings.title': 'ParamÃ¨tres',
    'settings.subtitle': 'GÃ©rez vos prÃ©fÃ©rences d\'application et donnÃ©es',
    'settings.voice.title': 'Voix et Prononciation',
    'settings.voice.subtitle': 'Personnalisez les paramÃ¨tres de synthÃ¨se vocale',
    'settings.voice.loading': 'Chargement des voix...',
    'settings.voice.description': 'Choisissez la langue que vous voulez pratiquer puis sÃ©lectionnez une voix spÃ©cifique qui vous semble la plus naturelle.',
    'settings.language.title': 'Langue et Apparence',
    'settings.language.subtitle': 'Choisissez votre langue et thÃ¨me prÃ©fÃ©rÃ©s',
    'settings.practice.language': 'Langue de Pratique',
    'settings.voice.selection': 'SÃ©lection de Voix',
    'settings.theme': 'ThÃ¨me',
    'settings.theme.light': 'Clair',
    'settings.theme.dark': 'Sombre',
    'settings.theme.system': 'SystÃ¨me',
    'settings.test.voice': 'Tester la Voix',
    'settings.data.title': 'Gestion des DonnÃ©es',
    'settings.data.subtitle': 'Exportez, importez ou gÃ©rez vos donnÃ©es de cartes',
    'settings.bulk.import': 'Import en Lot',
    'settings.bulk.subtitle': 'Ajoutez plusieurs cartes depuis du texte',
    'settings.export.title': 'Exporter les DonnÃ©es',
    'settings.export.description': 'TÃ©lÃ©chargez toutes vos cartes en fichier JSON pour sauvegarde ou transfert',
    'settings.export.loading': 'Exportation...',
    'settings.export': 'Exporter Toutes les Cartes',
    'settings.import': 'Importer des DonnÃ©es',
    'settings.import.description': 'TÃ©lÃ©chargez un fichier JSON pour importer des cartes (sera fusionnÃ© avec les cartes existantes)',
    'settings.import.loading': 'Importation...',
    'settings.about': 'Ã€ propos',
    'settings.about.description': 'Une application web progressive pour l\'apprentissage des langues avec rÃ©pÃ©tition espacÃ©e, stockage hors ligne, capacitÃ©s amÃ©liorÃ©es de synthÃ¨se vocale, mode sombre et support multilingue.',
    'settings.about.features': 'FonctionnalitÃ©s',
    'settings.about.feature.spaced': 'Algorithme de rÃ©pÃ©tition espacÃ©e pour un apprentissage optimal',
    'settings.about.feature.offline': 'Hors ligne d\'abord avec stockage IndexedDB',
    'settings.about.feature.voice': 'SÃ©lection de voix multilingue avec dÃ©tection automatique',
    'settings.about.feature.dark': 'Support du mode sombre et thÃ¨me systÃ¨me',
    'settings.about.feature.i18n': 'Internationalisation (Anglais, Espagnol, FranÃ§ais)',
    'settings.about.feature.progress': 'Suivi des progrÃ¨s et statistiques',
    'settings.about.feature.bulk': 'Import en lot pour plusieurs cartes',
    'settings.about.feature.import': 'FonctionnalitÃ© d\'import/export',
    'settings.danger': 'Zone Dangereuse',
    'settings.danger.subtitle': 'Actions irrÃ©versibles qui supprimeront dÃ©finitivement vos donnÃ©es',
    'settings.danger.warning': 'Cette action ne peut pas Ãªtre annulÃ©e. Assurez-vous d\'exporter vos donnÃ©es d\'abord.',
    'settings.delete.all': 'Supprimer Toutes les Cartes',
    
    // Test phrases
    'test.phrase.en': 'Hello! How are you? This is an English pronunciation test.',
    'test.phrase.es': 'Â¡Hola! Â¿CÃ³mo estÃ¡s? Esta es una prueba de pronunciaciÃ³n en espaÃ±ol.',
    'test.phrase.fr': 'Bonjour ! Comment allez-vous ? Ceci est un test de prononciation franÃ§aise.',

    // Confirmation dialogs
    'confirm.delete.all.title': 'Supprimer Toutes les Cartes',
    'confirm.delete.all.description': 'ÃŠtes-vous sÃ»r de vouloir supprimer toutes les cartes ? Cette action ne peut pas Ãªtre annulÃ©e.',
    'confirm.delete.all.confirm': 'Tout Supprimer',
    'confirm.delete.card.title': 'Supprimer la Carte',
    'confirm.delete.card.description': 'ÃŠtes-vous sÃ»r de vouloir supprimer cette carte ? Cette action ne peut pas Ãªtre annulÃ©e.',
    'confirm.delete.card.confirm': 'Supprimer',
    'confirm.cancel': 'Annuler',
    'confirm.continue': 'Continuer',
    
    // Success messages
    'success.import': 'Importation rÃ©ussie !',
    'success.export': 'Exportation terminÃ©e avec succÃ¨s !',
    'success.delete.all': 'Toutes les donnÃ©es ont Ã©tÃ© effacÃ©es.',
    'success.card.added': 'Carte ajoutÃ©e avec succÃ¨s !',
    'success.card.updated': 'Carte mise Ã  jour avec succÃ¨s !',
    'success.card.deleted': 'Carte supprimÃ©e avec succÃ¨s !',
    
    // Error messages
    'error.import': 'Ã‰chec de l\'importation. Veuillez vÃ©rifier le format du fichier et rÃ©essayer.',
    'error.export': 'Ã‰chec de l\'exportation. Veuillez rÃ©essayer.',
    'error.delete.all': 'Ã‰chec de la suppression des donnÃ©es. Veuillez rÃ©essayer.',
    'error.card.add': 'Ã‰chec de l\'ajout de la carte. Veuillez rÃ©essayer.',
    'error.card.update': 'Ã‰chec de la mise Ã  jour de la carte. Veuillez rÃ©essayer.',
    'error.card.delete': 'Ã‰chec de la suppression de la carte. Veuillez rÃ©essayer.',
    'error.load.cards': 'Ã‰chec du chargement des cartes. Veuillez rÃ©essayer.',
    'error.voice.change': 'Ã‰chec du changement de voix. Veuillez rÃ©essayer.',
    'error.voice.test': 'Ã‰chec du test de voix. Veuillez rÃ©essayer.',
  },
};

const detectBrowserLanguage = (): Language => {
  const browserLang = navigator.language.toLowerCase();
  if (browserLang.startsWith('es')) return 'es';
  if (browserLang.startsWith('fr')) return 'fr';
  return 'en'; // Default to English
};

export const I18nProvider: React.FC<{ children: React.ReactNode }> = ({ children }) => {
  const [language, setLanguage] = useState<Language>(() => {
    const stored = localStorage.getItem('language') as Language;
    return stored || detectBrowserLanguage();
  });

  useEffect(() => {
    localStorage.setItem('language', language);
  }, [language]);

  const t = (key: string): string => {
    return translations[language][key as keyof typeof translations[typeof language]] || key;
  };

  return (
    <I18nContext.Provider value={{ language, setLanguage, t }}>
      {children}
    </I18nContext.Provider>
  );
};
